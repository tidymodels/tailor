<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Re-calibrate classification probability predictions — adjust_probability_calibration • tailor</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Re-calibrate classification probability predictions — adjust_probability_calibration"><meta name="description" content="Calibration is the process of adjusting a model's outputted probabilities
to match the observed frequencies of events. This technique aims to
ensure that when a model predicts a certain probability for an outcome,
that probability accurately reflects the true likelihood of that outcome
occurring."><meta property="og:description" content="Calibration is the process of adjusting a model's outputted probabilities
to match the observed frequencies of events. This technique aims to
ensure that when a model predicts a certain probability for an outcome,
that probability accurately reflects the true likelihood of that outcome
occurring."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tailor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/tailor/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Re-calibrate classification probability predictions</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tailor/blob/main/R/adjust-probability-calibration.R" class="external-link"><code>R/adjust-probability-calibration.R</code></a></small>
      <div class="d-none name"><code>adjust_probability_calibration.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calibration is the process of adjusting a model's outputted probabilities
to match the observed frequencies of events. This technique aims to
ensure that when a model predicts a certain probability for an outcome,
that probability accurately reflects the true likelihood of that outcome
occurring.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">adjust_probability_calibration</span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code><a href="tailor.html">tailor()</a></code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character. One of <code>"logistic"</code>, <code>"multinomial"</code>,
<code>"beta"</code>, <code>"isotonic"</code>, or <code>"isotonic_boot"</code>, corresponding to the
function from the <span class="pkg">probably</span> package <code><a href="https://probably.tidymodels.org/reference/cal_estimate_logistic.html" class="external-link">probably::cal_estimate_logistic()</a></code>,
<code><a href="https://probably.tidymodels.org/reference/cal_estimate_multinomial.html" class="external-link">probably::cal_estimate_multinomial()</a></code>, etc., respectively.  The default is to
use <code>"logistic"</code> which, despite its name, fits a generalized additive model.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Optional arguments to pass to the corresponding function in the
<span class="pkg">probably</span> package. These arguments must be named.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An updated <code><a href="tailor.html">tailor()</a></code> containing the new operation.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The "logistic" and "multinomial" methods fit models that predict the observed
classes as a function of the predicted class probabilities. These models
remove any overt systematic trends from the linear predictor and correct new
predictions. The underlying code fits that model using <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code>.
If <code>smooth = FALSE</code> is passed to the <code>...</code>, it uses <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> for binary
outcomes or <code><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">nnet::multinom()</a></code> for 3+ classes.</p>
<p>The isotonic method uses <code><a href="https://rdrr.io/r/stats/isoreg.html" class="external-link">stats::isoreg()</a></code> to force the predicted
probabilities to increase with the observed outcome class. This creates a
step function that will map new predictions to values that are monotonically
increasing with the binary (0/1) form of the outcome. One side effect is
that there are fewer, perhaps far fewer, unique predicted probabilities.
For 3+ classes, this is done using a one-versus-all strategy that ensures
that the probabilities add to 1.0. The "isotonic boot" method resamples the
data and generates multiple isotonic regressions that are averaged and used
to correct the predictions. This may not be perfectly monotonic, but the
number of unique calibrated predictions increases with the number of
bootstrap samples (controlled by passing the <code>times</code> argument to <code>...</code>).</p>
<p>Beta calibration (Kull <em>et al</em>, 2017) assumes that the probability estimates
follow a Beta distribution. This leads to a sigmoidal model that can be fit
to the data via maximum likelihood. There are a few different ways to fit
the model; see <code><a href="https://rdrr.io/pkg/betacal/man/beta_calibration.html" class="external-link">betacal:: beta_calibration()</a></code> options <code>parameters</code> to select
a specific sigmoidal model.</p>
    </div>
    <div class="section level2">
    <h2 id="data-usage">Data Usage<a class="anchor" aria-label="anchor" href="#data-usage"></a></h2>


<p>This adjustment requires estimation and, as such, different subsets of data
should be used to train it and evaluate its predictions.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Kull, Meelis, Telmo Silva Filho, and Peter Flach. "Beta calibration: a
well-founded and easily implemented improvement on logistic calibration
for binary classifiers." Artificial intelligence and statistics. PMLR, 2017.</p>
<p><a href="https://aml4td.org/chapters/cls-metrics.html#sec-cls-calibration" class="external-link">https://aml4td.org/chapters/cls-metrics.html#sec-cls-calibration</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeldata.tidymodels.org" class="external-link">modeldata</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># split example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">in_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">two_class_example</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d_calibration</span> <span class="op">&lt;-</span> <span class="va">two_class_example</span><span class="op">[</span><span class="va">in_rows</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">d_test</span> <span class="op">&lt;-</span> <span class="va">two_class_example</span><span class="op">[</span><span class="op">!</span><span class="va">in_rows</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d_calibration</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    truth      Class1       Class2 predicted</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Class2 0.003589243 0.9964107574    Class2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Class2 0.110893522 0.8891064779    Class2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Class1 0.735161703 0.2648382969    Class1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Class1 0.999275071 0.0007249286    Class1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 Class1 0.999201149 0.0007988510    Class1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 Class1 0.812351997 0.1876480026    Class1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># specify calibration</span></span></span>
<span class="r-in"><span><span class="va">tlr</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="tailor.html">tailor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">adjust_probability_calibration</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"logistic"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># train tailor on a subset of data.</span></span></span>
<span class="r-in"><span><span class="va">tlr_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">tlr</span>,</span></span>
<span class="r-in"><span>  <span class="va">d_calibration</span>,</span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">truth</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  probabilities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Class1</span>, <span class="va">Class2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># apply to predictions on another subset of data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d_test</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     truth       Class1      Class2 predicted</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  Class1 0.6786210540 0.321378946    Class1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  Class2 0.0162399603 0.983760040    Class2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  Class2 0.4570372595 0.542962741    Class2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 Class2 0.0976377342 0.902362266    Class2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 Class1 0.9919162773 0.008083723    Class1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 Class2 0.0004250834 0.999574917    Class2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">tlr_fit</span>, <span class="va">d_test</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 244 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    truth     Class1    Class2 predicted</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl[1d]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl[1d]&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> Class1    0.459     0.541  Class2   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> Class2    0.039<span style="text-decoration: underline;">6</span>    0.960  Class2   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> Class2    0.333     0.667  Class2   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> Class2    0.095<span style="text-decoration: underline;">4</span>    0.905  Class2   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> Class1    0.964     0.035<span style="text-decoration: underline;">9</span> Class1   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> Class2    0.032<span style="text-decoration: underline;">8</span>    0.967  Class2   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> Class2    0.112     0.888  Class2   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> Class1    0.665     0.335  Class1   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> Class1    0.957     0.043<span style="text-decoration: underline;">4</span> Class1   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> Class2    0.053<span style="text-decoration: underline;">4</span>    0.947  Class2   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 234 more rows</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Couch, Hannah Frick, Emil HvitFeldt, Max Kuhn, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

